<DOCTYPE html>
<html>
    <head>
        <title>机选</title>
        <script src="jquery-3.1.1.min.js"></script>
        <style>
            *{font-size:1.2em;font-family:微软雅黑, Arial, Helvetica, sans-serif;}
            ul{
                -moz-column-count:2; 	/* Firefox */
                -webkit-column-count:2; /* Safari 和 Chrome */
                column-count:2;
                list-style-type:none;
            }
            ul li{
                line-height:2em;
            }
            p.result{
                text-align:center;
            }
            p#voteResult{
                font-size:3em;
            }
            button{
                width:320px;height:80px;
                font-size:1.2em;
                vertical-align:middle;
            }
        </style>
    </head>
    <body>
        <p id="titleP"></p>
        <ul id="voteList"></ul>
        <p class="result">
            <button onclick="showList(unitTable)">返回单位列表</button>
            <button onclick="showSelectName()">开始机选</button>
        </p>
        <p class="result" id="voteResult">
            <a>[机选结果]</a>
        </p>
        <!-- javascript -->
        <script>
            //// 通用方法
            // 获取对象长度
            var getObjectLength = function(o){
                var count = 0;
                for(var p in o){
                    if(o.hasOwnProperty(p)){
                        count++;
                    }
                }
                return count;
            };
            // 返回随机数
            var getRnd = function(l){
                var test = Math.random();
                // 正常公式时 random 几乎不为零，所以提升总数加一计算随机数再减一
                var random = Math.floor(test*(l-0)+1);
                return random-1;
            };
            // 在列表中随机选取结果
            var selectName = function(o){
                // var rnd = getRnd(getObjectLength(unitTable));
                var rnd = getRnd($('#voteList')[0].children.length);
                return voteList0[0].childNodes[rnd].innerText;

            };
            // 绑定点击
            var prepareClick = function(str){
                if(str){
                    $('#voteResult')[0].childNodes[1].onclick = function(){
                        console.log(showArea(this));
                    };
                }
                units = document.getElementsByClassName("unit");
                for(var i=0;i<units.length;i++){
                    units[i].onclick = function(){
                        console.log(showArea(this));
                    }
                }
            }
            var showArea = function(o){
                showList(unitTable[o.innerText]);
                return o.innerText;
            }
            //// 读取数据

            //// 格式化数据
            // 初始化对象
            var unitTable = {
                "区政府办":["政府area01","政府area02","政府area03"],
                "区发改局":["area01","area02","area03"],
                "区科经信局":["area01","area02","area03"],
                "区教育局":["area01","area02","area03"],
                "区公安分局":["area01","area02","area03"],
                "区民政局":["area01","area02","area03"],
                "区司法局":["area01","area02","area03"],
                "区财政局":["area01","area02","area03"],
                "区人社局":["area01","area02","area03"],
                "区国土局":["area01","area02","area03"],
                "区环保局":["area01","area02","area03"],
                "区建设局（区人防办）":["area01","area02","area03"],
                "区规划局":["area01","area02","area03"],
                "区城管局":["area01","area02","area03"],
                "区交通局":["area01","area02","area03"],
                "区水务局":["area01","area02","area03"],
                "区农林局":["area01","area02","area03"],
                "区商务投促局":["area01","area02","area03"],
                "区文体广新旅游局":["area01","area02","area03"],
                "区卫计局":["area01","area02","area03"],
                "区审计局":["area01","area02","area03"],
                "区市场和质量监管局":["area01","area02","area03"],
                "区安监局":["area01","area02","area03"],
                "区统计局":["area01","area02","area03"],
                "区房管局":["area01","area02","area03"],
                "区档案局":["area01","area02","area03"],
                "区供销联社":["area01","area02","area03"],
                "区地志办":["area01","area02","area03"],
                "区旅发中心":["area01","area02","area03"],
                "区机关事务中心":["area01","area02","area03"],
                "区政务中心":["area01","area02","area03"],
                "区交易中心":["area01","area02","area03"],
                "区工管委":["area01","area02","area03"],
                "港管委":["area01","area02","area03"],
                "大弯街道":["area01","area02","area03"],
                "红阳街道":["area01","area02","area03"],
                "弥牟镇":["area01","area02","area03"],
                "城厢镇":["area01","area02","area03"],
                "大同镇":["area01","area02","area03"],
                "祥福镇":["area01","area02","area03"],
                "清泉镇":["area01","area02","area03"],
                "姚渡镇":["area01","area02","area03"],
                "龙王镇":["area01","area02","area03"],
                "福洪镇":["area01","area02","area03"],
                "人和乡":["area01","area02","area03"]
            };
            // 声明数据对象的数组变量
            //var voteListArray = []

            //// 获取页面列表元素
            var voteList0 = $('#voteList');

            //// 填充页面列表
            var listArrayItem = null;
            var showList = function(obj){
                voteList0[0].innerHTML = "";
                if(Array.isArray(obj)){
                    for(var p in obj){
                        listArrayItem = "<li class='area'>"+obj[p]+"</li>";
                        voteList0.append(listArrayItem);
                    }
                }
                else{
                    for(var p in obj){
                        listArrayItem = "<li class='unit'>"+p+"</li>";
                        voteList0.append(listArrayItem);
                    }
                }
                prepareClick();
            }
            showList(unitTable);
            //// 填充选取结果
            var showSelectName = function(o){
                var name = selectName(unitTable);
                $('#voteResult')[0].childNodes[1].innerText = name;
                prepareClick(name);
            }
        </script>
    </body>
</html>
